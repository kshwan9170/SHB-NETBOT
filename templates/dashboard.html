<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHB-NetBot ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modern.css') }}">
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Bootstrap CSS ì¶”ê°€ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ ê°•í™” -->
    <style>
        /* ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ ê°•í™” - ë©”ì¸ í˜ì´ì§€ì™€ ë™ì¼í•˜ê²Œ */
        .navbar {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            z-index: 1000 !important;
            background-color: #1A2B4C !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
            padding: 1rem 0 !important;
        }
        
        .navbar-container {
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            max-width: 1200px !important;
            margin: 0 auto !important;
            padding: 0 2rem !important;
            height: 70px !important;
        }
        
        .logo {
            display: flex !important;
            align-items: center !important;
            gap: 0.75rem !important;
            height: 3.2rem !important;
            margin-right: 3rem !important; /* ë¡œê³ ì™€ ë„¤ë¹„ê²Œì´ì…˜ ê°„ ì—¬ë°± ì¶”ê°€ */
        }
        
        .logo span {
            font-size: 1.8rem !important;
            font-weight: 600 !important;
            color: #FFFFFF !important;
            letter-spacing: -0.5px !important;
            line-height: 3.2rem !important;
            display: flex !important;
            align-items: center !important;
        }
        
        .bot-name {
            font-size: 1.8rem !important;
            font-weight: 600 !important;
            color: #FFFFFF !important;
            line-height: 3.2rem !important;
            display: flex !important;
            align-items: center !important;
            margin-left: 0.75rem !important;
        }
        
        .nav-links {
            display: flex !important;
            align-items: center !important;
            gap: 3rem !important;
        }
        
        .nav-link {
            color: #FFFFFF !important;
            font-weight: 550 !important; /* ê¸€ì êµµê¸° 550ìœ¼ë¡œ ì„¤ì • */
            font-size: 1.5rem !important; /* í¬ê¸°ëŠ” ì›ë˜ëŒ€ë¡œ */
            position: relative !important;
            transition: all 0.2s !important;
            text-decoration: none !important;
        }
        
        .nav-link:hover,
        .nav-link.active {
            color: #BFD7FF !important;
        }
        
        .nav-link::after {
            content: '' !important;
            position: absolute !important;
            bottom: -0.8rem !important;
            left: 0 !important;
            width: 0 !important;
            height: 2px !important;
            background-color: #BFD7FF !important;
            transition: width 0.3s !important;
        }
        
        .nav-link:hover::after,
        .nav-link.active::after {
            width: 100% !important;
        }
        
        .theme-toggle {
            background: none !important;
            border: none !important;
            color: #FFFFFF !important;
            cursor: pointer !important;
            padding: 0.5rem !important;
            border-radius: 50% !important;
            transition: background-color 0.2s !important;
        }
        
        .theme-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1) !important;
        }
        
        /* ëª¨ë°”ì¼ ë©”ë‰´ ë²„íŠ¼ */
        .mobile-menu-btn {
            display: none !important;
            flex-direction: column !important;
            cursor: pointer !important;
            gap: 0.3rem !important;
        }
        
        .mobile-menu-btn .bar {
            width: 2.5rem !important;
            height: 0.3rem !important;
            background-color: #FFFFFF !important;
            transition: all 0.3s !important;
        }
        
        /* ë©”ì¸ ì½˜í…ì¸  ìƒë‹¨ ì—¬ë°± ì¡°ì • */
        .container.my-5 {
            margin-top: 100px !important;
        }
        
        /* ë°˜ì‘í˜• ì²˜ë¦¬ */
        @media (max-width: 768px) {
            .nav-links {
                display: none !important;
            }
            
            .mobile-menu-btn {
                display: flex !important;
            }
        }
    </style>
</head>
<body>
    <!-- ê³ ì • ë‚´ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="logo">
                <img src="{{ url_for('static', filename='images/shinhan_logo_new.png') }}" alt="ì‹ í•œì€í–‰ ë¡œê³ " class="logo-img shinhan-logo-white">
                <span>ì‹ í•œì€í–‰</span>
                <span class="bot-name">SHB-NetBot</span>
            </div>
            <div class="nav-links">
                <a href="/#home" class="nav-link">Home</a>
                <a href="/#about" class="nav-link">About</a>
                <a href="/#chat" class="nav-link">Chat</a>
                <a href="/#documents" class="nav-link">Documents</a>
                <a href="/dashboard" class="nav-link active">Dashboard</a>
                <a href="/#support" class="nav-link">Support</a>
                <button id="theme-toggle" class="theme-toggle">
                    <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </div>
            <div class="mobile-menu-btn">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <!-- í—¤ë” ì˜ì—­ -->
        <div class="text-center mb-5">
            <h1 class="display-4" style="color: #30507A; font-family: 'Inter', sans-serif; font-weight: 600;">SHB-NetBot ëŒ€ì‹œë³´ë“œ</h1>
            <p class="lead" style="color: #5A6373; font-family: 'Inter', sans-serif; font-weight: 400;">ì‹¤ì‹œê°„ ì‚¬ìš©ì ë¬¸ì˜ ë° í†µê³„ ë¶„ì„</p>
        </div>
    
    <!-- í•„í„° ì˜ì—­ -->
    <div class="card mb-4 shadow-sm filter-card" style="border-color: #E6EBF4;">
        <div class="card-body">
            <div class="d-flex align-items-center mb-3">
                <i class="fas fa-filter fa-2x me-3" style="color: #30507A;"></i>
                <div>
                    <h5 class="card-title mb-1" style="color: #30507A; font-family: 'Inter', sans-serif; font-weight: 600;">ì¡°íšŒ í•„í„°</h5>
                    <small class="text-muted">ê¸°ê°„ ë° ì¹´í…Œê³ ë¦¬ ì„¤ì •</small>
                </div>
            </div>
            <div class="row align-items-end">
                <div class="col-md-4 mb-3">
                    <label for="period-select" class="form-label filter-label" style="font-family: 'Inter', sans-serif; font-weight: 500;">ê¸°ê°„</label>
                    <select id="period-select" class="form-select filter-select" style="font-family: 'Inter', sans-serif; font-weight: 400;">
                        <option value="all" selected>ì „ì²´ ê¸°ê°„</option>
                        <option value="day">ì˜¤ëŠ˜</option>
                        <option value="week">ìµœê·¼ 7ì¼</option>
                        <option value="month">ìµœê·¼ 30ì¼</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="category-select" class="form-label filter-label" style="font-family: 'Inter', sans-serif; font-weight: 500;">ì¹´í…Œê³ ë¦¬</label>
                    <select id="category-select" class="form-select filter-select" style="font-family: 'Inter', sans-serif; font-weight: 400;">
                        <option value="" selected>ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                        <!-- ì¹´í…Œê³ ë¦¬ ì˜µì…˜ì€ JavaScriptë¡œ ë™ì  ìƒì„± -->
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <button id="refresh-button" class="btn btn-primary w-100 filter-button" style="background-color: #30507A; border-color: #30507A; font-family: 'Inter', sans-serif; font-weight: 500;">
                        <i class="fas fa-sync-alt me-2"></i> ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- í†µê³„ ìš”ì•½ ì¹´ë“œ -->
    <div class="row mb-4">
        <!-- ì „ì²´ ì§ˆë¬¸ ìˆ˜ -->
        <div class="col-md-4 mb-3">
            <div class="card h-100 shadow-sm queries-card" style="border-color: #E6EBF4; cursor: pointer; transition: all 0.3s ease;" onclick="showQueriesDetails()" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 20px rgba(48, 80, 122, 0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow=''">
                <div class="card-body text-center">
                    <h5 class="card-title" style="color: #30507A;">ì „ì²´ ì§ˆë¬¸ ìˆ˜</h5>
                    <div class="d-flex align-items-center justify-content-center">
                        <i class="fas fa-comments fa-3x me-3" style="color: #30507A;"></i>
                        <div class="display-4 fw-bold" id="total-queries">0</div>
                    </div>
                    <div class="small text-muted">ğŸ“Š ëˆ„ì  ë¬¸ì˜ëŸ‰ <br><span style="color: #30507A; font-weight: 600;">ğŸ‘† í´ë¦­í•˜ì—¬ ìƒì„¸ë³´ê¸°</span></div>
                </div>
            </div>
        </div>
        
        <!-- ìµœê·¼ ë°©ë¬¸ì -->
        <div class="col-md-4 mb-3">
            <div class="card h-100 shadow-sm visitor-card" style="border-color: #E6EBF4; cursor: pointer; transition: all 0.3s ease;" onclick="openVisitorModal()" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 20px rgba(48, 80, 122, 0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow=''">
                <div class="card-body text-center">
                    <h5 class="card-title" style="color: #30507A;">ìµœê·¼ ë°©ë¬¸ì</h5>
                    <div class="d-flex align-items-center justify-content-center">
                        <i class="fas fa-users fa-3x me-3" id="visitors-icon" style="color: #17a2b8;"></i>
                        <div class="display-4 fw-bold" id="recent-visitors">0</div>
                    </div>
                    <div class="small text-muted" id="visitors-description">ğŸ‘¥ ì§€ë‚œ 24ì‹œê°„ <br><span style="color: #30507A; font-weight: 600;">ğŸ‘† í´ë¦­í•˜ì—¬ ìƒì„¸ë³´ê¸°</span></div>
                </div>
            </div>
        </div>
        
        <!-- ì‚¬ìš©ì ë§Œì¡±ë„ -->
        <div class="col-md-4 mb-3">
            <div class="card h-100 shadow-sm satisfaction-card" style="border-color: #E6EBF4; cursor: pointer; transition: all 0.3s ease;" onclick="showSatisfactionDetails()" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 20px rgba(255, 193, 7, 0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow=''">
                <div class="card-body text-center">
                    <h5 class="card-title" style="color: #30507A;">ì‚¬ìš©ì ë§Œì¡±ë„</h5>
                    <div class="d-flex align-items-center justify-content-center">
                        <i class="fas fa-smile fa-3x me-3" style="color: #ffc107;"></i>
                        <div>
                            <div class="display-4 fw-bold" id="positive-percentage">0%</div>
                            <small class="text-muted" id="positive-count-display">ğŸ˜Š ë§Œì¡±ë„ í†µê³„ <br><span style="color: #30507A; font-weight: 600;">ğŸ‘† í´ë¦­í•˜ì—¬ ìƒì„¸ë³´ê¸°</span></small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ì£¼ìš” ë¬¸ì˜ TOP 10 ì°¨íŠ¸ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm top-queries-chart-card" style="border-color: #E6EBF4;">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <i class="fas fa-chart-bar fa-2x me-3" style="color: #30507A;"></i>
                        <div>
                            <h5 class="card-title mb-1" style="color: #30507A; font-family: 'Inter', sans-serif; font-weight: 600;">ì£¼ìš” ë¬¸ì˜ TOP 10</h5>
                            <small class="text-muted">ì‹¤ì‹œê°„ ì¸ê¸° ì§ˆë¬¸ ìˆœìœ„</small>
                        </div>
                    </div>
                    <div class="chart-container" style="position: relative; height:400px;">
                        <canvas id="top-queries-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>


</div>

<!-- í‘¸í„° ì„¹ì…˜ -->
<footer class="footer">
    <div class="footer-container">
        <div class="footer-content">
            <div class="footer-grid">
                <div class="footer-col">
                    <h3>ì„œë¹„ìŠ¤</h3>
                    <div class="footer-links">
                        <a href="#home" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                            í™ˆ
                        </a>
                        <a href="#about" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                            ì†Œê°œ
                        </a>
                        <a href="#chat" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            ëŒ€í™”í•˜ê¸°
                        </a>
                        <a href="#documents" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                            ë¬¸ì„œ
                        </a>
                    </div>
                </div>
                <div class="footer-col">
                    <h3>ê³ ê°ì§€ì›</h3>
                    <div class="footer-links">
                        <a href="/inquiry" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                            ë¬¸ì˜í•˜ê¸°
                        </a>
                        <a href="/feedback" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                            </svg>
                            í”¼ë“œë°±
                        </a>
                        <a href="/report" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                            ì‹ ê³ í•˜ê¸°
                        </a>
                        <a href="#dashboard" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            </svg>
                            ëŒ€ì‹œë³´ë“œ
                        </a>
                    </div>
                </div>
                <div class="footer-col">
                    <h3>ì •ë³´</h3>
                    <div class="footer-links">
                        <a href="/terms" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                            ì´ìš©ì•½ê´€
                        </a>
                        <a href="/privacy" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                            </svg>
                            ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨
                        </a>
                        <a href="/copyright" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M15 9.354a4 4 0 1 0 0 5.292"></path>
                            </svg>
                            ì €ì‘ê¶Œ
                        </a>
                        <a href="/security" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                            </svg>
                            ë³´ì•ˆì •ì±…
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 ì‹ í•œì€í–‰. All rights reserved.</p>
        </div>
    </div>
</footer>

<!-- ë°©ë¬¸ì ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
<div class="modal fade" id="visitorDetailsModal" tabindex="-1" aria-labelledby="visitorDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #30507A;">
                <h5 class="modal-title text-white" id="visitorDetailsModalLabel">
                    <i class="fas fa-users me-2"></i>ë°©ë¬¸ì ìƒì„¸ ì •ë³´
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-3">
                    <div class="col-md-4">
                        <div class="card text-center" style="border-color: #E6EBF4;">
                            <div class="card-body">
                                <h6 class="card-title" style="color: #30507A;">ì´ ê³ ìœ  IP</h6>
                                <div class="h4 mb-0" id="total-unique-ips">-</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center" style="border-color: #E6EBF4;">
                            <div class="card-body">
                                <h6 class="card-title" style="color: #30507A;">ì´ ë°©ë¬¸ ìˆ˜</h6>
                                <div class="h4 mb-0" id="total-visit-count">-</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center" style="border-color: #E6EBF4;">
                            <div class="card-body">
                                <h6 class="card-title" style="color: #30507A;">ì¡°íšŒ ê¸°ê°„</h6>
                                <div class="h6 mb-0">ì§€ë‚œ 24ì‹œê°„</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- IPë³„ í†µê³„ í…Œì´ë¸” -->
                <div class="card mb-3" style="border-color: #E6EBF4;">
                    <div class="card-header" style="background-color: #F8F9FA;">
                        <h6 class="mb-0" style="color: #30507A;">
                            <i class="fas fa-chart-bar me-2"></i>IPë³„ ë°©ë¬¸ í†µê³„
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover" id="ip-stats-table">
                                <thead style="background-color: #F8F9FA;">
                                    <tr>
                                        <th style="color: #30507A;">IP ì£¼ì†Œ</th>
                                        <th style="color: #30507A;">ë°©ë¬¸ íšŸìˆ˜</th>
                                        <th style="color: #30507A;">ë°©ë¬¸ í˜ì´ì§€</th>
                                        <th style="color: #30507A;">ìµœì´ˆ ë°©ë¬¸</th>
                                        <th style="color: #30507A;">ìµœê·¼ ë°©ë¬¸</th>
                                    </tr>
                                </thead>
                                <tbody id="ip-stats-tbody">
                                    <!-- ë°ì´í„° ë¡œë”© ì¤‘ -->
                                    <tr>
                                        <td colspan="5" class="text-center">
                                            <div class="spinner-border spinner-border-sm" role="status"></div>
                                            ë°ì´í„° ë¡œë”© ì¤‘...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ìµœê·¼ ë°©ë¬¸ ê¸°ë¡ -->
                <div class="card" style="border-color: #E6EBF4;">
                    <div class="card-header" style="background-color: #F8F9FA;">
                        <h6 class="mb-0" style="color: #30507A;">
                            <i class="fas fa-clock me-2"></i>ìµœê·¼ ë°©ë¬¸ ê¸°ë¡ (ìµœëŒ€ 50ê°œ)
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm table-hover" id="visitor-records-table">
                                <thead style="background-color: #F8F9FA;">
                                    <tr>
                                        <th style="color: #30507A;">ì‹œê°„</th>
                                        <th style="color: #30507A;">IP ì£¼ì†Œ</th>
                                        <th style="color: #30507A;">ë°©ë¬¸ í˜ì´ì§€</th>
                                    </tr>
                                </thead>
                                <tbody id="visitor-records-tbody">
                                    <!-- JavaScriptë¡œ ì±„ì›Œì§ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                <button type="button" class="btn btn-primary" onclick="refreshVisitorData()" style="background-color: #30507A; border-color: #30507A;">
                    <i class="fas fa-sync-alt me-2"></i>ìƒˆë¡œê³ ì¹¨
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ì‚¬ìš©ì ë§Œì¡±ë„ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
<div class="modal fade" id="satisfactionDetailsModal" tabindex="-1" aria-labelledby="satisfactionDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #ffc107;">
                <h5 class="modal-title text-white" id="satisfactionDetailsModalLabel">
                    <i class="fas fa-chart-pie me-2"></i>ì‚¬ìš©ì ë§Œì¡±ë„ ìƒì„¸ ë¶„ì„
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- í†µê³„ ìš”ì•½ -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card text-center" style="border-color: #E6EBF4;">
                            <div class="card-body">
                                <h6 class="card-title" style="color: #30507A;">ì „ì²´ í”¼ë“œë°±</h6>
                                <div class="h4 mb-0" id="total-feedback-count">-</div>
                                <small class="text-muted">ìµœê·¼ 30ì¼</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center" style="border-color: #E6EBF4; border-left: 4px solid #28a745;">
                            <div class="card-body">
                                <h6 class="card-title" style="color: #28a745;">ë§Œì¡±í•´ìš”</h6>
                                <div class="h4 mb-0" id="positive-feedback-count">-</div>
                                <small class="text-muted" id="positive-percentage-detail">0%</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center" style="border-color: #E6EBF4; border-left: 4px solid #dc3545;">
                            <div class="card-body">
                                <h6 class="card-title" style="color: #dc3545;">ê°œì„ í•„ìš”</h6>
                                <div class="h4 mb-0" id="negative-feedback-count">-</div>
                                <small class="text-muted" id="negative-percentage-detail">0%</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center" style="border-color: #E6EBF4;">
                            <div class="card-body">
                                <h6 class="card-title" style="color: #30507A;">ë§Œì¡±ë„</h6>
                                <div class="h4 mb-0" id="satisfaction-rate-detail">-</div>
                                <small class="text-muted">ì „ì²´ í‰ê· </small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì¼ë³„ ì¶”ì´ ì°¨íŠ¸ -->
                <div class="card mb-4" style="border-color: #E6EBF4;">
                    <div class="card-header" style="background-color: #F8F9FA;">
                        <h6 class="mb-0" style="color: #30507A;">
                            <i class="fas fa-chart-line me-2"></i>ì¼ë³„ í”¼ë“œë°± ì¶”ì´ (ìµœê·¼ 7ì¼)
                        </h6>
                    </div>
                    <div class="card-body">
                        <canvas id="feedbackTrendChart" height="100"></canvas>
                    </div>
                </div>

                <div class="row">
                    <!-- ê°œì„ í•„ìš” í”¼ë“œë°± -->
                    <div class="col-md-6">
                        <div class="card h-100" style="border-color: #E6EBF4; border-left: 4px solid #dc3545;">
                            <div class="card-header" style="background-color: #F8F9FA;">
                                <h6 class="mb-0" style="color: #dc3545;">
                                    <i class="fas fa-exclamation-triangle me-2"></i>ìµœê·¼ ê°œì„ í•„ìš” í”¼ë“œë°± (ìµœëŒ€ 20ê°œ)
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                    <table class="table table-sm table-hover">
                                        <thead style="background-color: #F8F9FA; position: sticky; top: 0;">
                                            <tr>
                                                <th style="color: #30507A;">ì‹œê°„</th>
                                                <th style="color: #30507A;">ì§ˆë¬¸ ë‚´ìš©</th>
                                                <th style="color: #30507A; width: 80px;">ì‘ì—…</th>
                                            </tr>
                                        </thead>
                                        <tbody id="negative-feedback-tbody">
                                            <tr>
                                                <td colspan="3" class="text-center">
                                                    <div class="spinner-border spinner-border-sm" role="status"></div>
                                                    ë°ì´í„° ë¡œë”© ì¤‘...
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ë§Œì¡± í”¼ë“œë°± -->
                    <div class="col-md-6">
                        <div class="card h-100" style="border-color: #E6EBF4; border-left: 4px solid #28a745;">
                            <div class="card-header" style="background-color: #F8F9FA;">
                                <h6 class="mb-0" style="color: #28a745;">
                                    <i class="fas fa-thumbs-up me-2"></i>ìµœê·¼ ë§Œì¡± í”¼ë“œë°± (ìµœëŒ€ 20ê°œ)
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                    <table class="table table-sm table-hover">
                                        <thead style="background-color: #F8F9FA; position: sticky; top: 0;">
                                            <tr>
                                                <th style="color: #30507A;">ì‹œê°„</th>
                                                <th style="color: #30507A;">ì§ˆë¬¸ ë‚´ìš©</th>
                                            </tr>
                                        </thead>
                                        <tbody id="positive-feedback-tbody">
                                            <!-- JavaScriptë¡œ ì±„ì›Œì§ -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                <button type="button" class="btn btn-primary" onclick="refreshSatisfactionData()" style="background-color: #ffc107; border-color: #ffc107; color: #000;">
                    <i class="fas fa-sync-alt me-2"></i>ìƒˆë¡œê³ ì¹¨
                </button>
            </div>
        </div>
    </div>
</div>

<!-- í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script defer src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<!-- Chart.js -->
<script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- AOS ì• ë‹ˆë©”ì´ì…˜ -->
<script defer src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script>
  AOS.init();
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // ì°¨íŠ¸ ê°ì²´ (ì´ˆê¸°í™” í›„ ë‚˜ì¤‘ì— ì—…ë°ì´íŠ¸)
    let topQueriesChart;
    
    // í˜ì´ì§€ ë¡œë“œì‹œ ë°ì´í„° ì¡°íšŒ
    refreshDashboard();
    
    // ë¶€ì • í”¼ë“œë°± ì¹´ë“œ ì´ˆê¸°í™”
    updateNegativeFeedbackCard();
    




    // í•¨ìˆ˜ëŠ” ì „ì—­ìœ¼ë¡œ ì´ë™ë¨

    // í˜¸í™˜ì„±ì„ ìœ„í•œ showVisitorModal í•¨ìˆ˜ (openVisitorModalë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸)
    function showVisitorModal() {
        openVisitorModal();
    }
    
    // ì „ì—­ìœ¼ë¡œë„ ë“±ë¡
    window.showVisitorModal = showVisitorModal;

    // ë°©ë¬¸ì ìˆ˜ ì•ˆì „í•˜ê²Œ ì—…ë°ì´íŠ¸
    (function() {
        try {
            fetch('/api/feedback_stats')
                .then(response => response.json())
                .then(data => {
                    if (data && data.success && typeof data.unique_visitors_24h === 'number') {
                        const visitorElement = document.getElementById('recent-visitors');
                        if (visitorElement) {
                            visitorElement.innerText = data.unique_visitors_24h;
                            console.log('ë°©ë¬¸ì ìˆ˜ ì—…ë°ì´íŠ¸:', data.unique_visitors_24h);
                        }
                    }
                })
                .catch(() => {}); // ì˜¤ë¥˜ ë¬´ì‹œ
        } catch(e) {
            // ì˜¤ë¥˜ ë¬´ì‹œ
        }
    })();
    
    // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    document.getElementById('refresh-button').addEventListener('click', refreshDashboard);
    
    // í•„í„° ë³€ê²½ ì´ë²¤íŠ¸
    document.getElementById('period-select').addEventListener('change', refreshDashboard);
    document.getElementById('category-select').addEventListener('change', refreshDashboard);
    
    // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ì¡°íšŒ ë° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function refreshDashboard() {
        // ë¡œë”© í‘œì‹œ (í•„ìš”ì‹œ êµ¬í˜„)
        
        // í•„í„° ê°’ ê°€ì ¸ì˜¤ê¸°
        const period = document.getElementById('period-select').value;
        const category = document.getElementById('category-select').value;
        
        // API í˜¸ì¶œ
        fetch(`/api/top_queries?period=${period}&category=${category}&limit=10`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateDashboard(data);
                } else {
                    console.error('ë°ì´í„° ì¡°íšŒ ì˜¤ë¥˜:', data.error);
                    // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ (í•„ìš”ì‹œ êµ¬í˜„)
                }
            })
            .catch(error => {
                console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ (í•„ìš”ì‹œ êµ¬í˜„)
            });
    }
    
    // ëŒ€ì‹œë³´ë“œ UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateDashboard(data) {
        // ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ì—…ë°ì´íŠ¸
        updateCategoryOptions(data.category_stats);
        
        // í†µê³„ ìš”ì•½ ì—…ë°ì´íŠ¸
        updateSummaryStats(data);
        
        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        updateTopQueriesChart(data.top_queries);
        
        // í…Œì´ë¸” ì—…ë°ì´íŠ¸
        updateQueryTable(data.top_queries);
        
        // í”¼ë“œë°± í†µê³„ ì—…ë°ì´íŠ¸ (ìƒˆë¡œìš´ ê¸°ëŠ¥)
        updateFeedbackStats();
    }
    
    // ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ì—…ë°ì´íŠ¸
    function updateCategoryOptions(categoryStats) {
        const categorySelect = document.getElementById('category-select');
        const currentValue = categorySelect.value;
        
        // í˜„ì¬ ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ìœ ì§€í•˜ë©´ì„œ ëª©ë¡ ì—…ë°ì´íŠ¸
        // ì²« ë²ˆì§¸ ì˜µì…˜(ì „ì²´ ì¹´í…Œê³ ë¦¬)ëŠ” ìœ ì§€
        while (categorySelect.options.length > 1) {
            categorySelect.remove(1);
        }
        
        // ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ì¶”ê°€
        categoryStats.forEach(stat => {
            const option = document.createElement('option');
            option.value = stat.category;
            option.textContent = `${stat.category} (${stat.total_count})`;
            categorySelect.appendChild(option);
        });
        
        // ì´ì „ ì„ íƒ ê°’ ë³µì› (ì¡´ì¬í•˜ëŠ” ê²½ìš°)
        if (currentValue) {
            for (let i = 0; i < categorySelect.options.length; i++) {
                if (categorySelect.options[i].value === currentValue) {
                    categorySelect.selectedIndex = i;
                    break;
                }
            }
        }
    }
    
    // í†µê³„ ìš”ì•½ ì—…ë°ì´íŠ¸
    function updateSummaryStats(data) {
        // ì „ì²´ ì§ˆë¬¸ ìˆ˜
        document.getElementById('total-queries').textContent = 
            data.top_queries.reduce((sum, query) => sum + query.count, 0);
        
        // í”¼ë“œë°± ì¹´ë“œ ì—…ë°ì´íŠ¸ ë° ë°©ë¬¸ì ìˆ˜ ì—…ë°ì´íŠ¸
        updateFeedbackCard();
        
        // ë°©ë¬¸ì ì¹´ë“œë„ ë³„ë„ë¡œ ì—…ë°ì´íŠ¸
        updateVisitorCard();
    }
    
    // ë°©ë¬¸ì ì¹´ë“œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì‹¤ì œ API ë°ì´í„° ì‚¬ìš©)
    function updateVisitorCard() {
        fetch('/api/visitor_details')
            .then(response => response.json())
            .then(data => {
                if (data && data.success) {
                    const visitorsText = document.getElementById('recent-visitors');
                    const visitorsIcon = document.getElementById('visitors-icon');
                    const visitorsDescription = document.getElementById('visitors-description');
                    
                    if (visitorsText) {
                        // ì‹¤ì œ ê³ ìœ  IP ìˆ˜ í‘œì‹œ
                        const actualUniqueIPs = data.ip_statistics ? data.ip_statistics.length : 0;
                        visitorsText.textContent = actualUniqueIPs;
                        console.log('ë°©ë¬¸ì ì¹´ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ:', actualUniqueIPs);
                        
                        if (visitorsIcon) {
                            visitorsIcon.style.color = '#17a2b8'; // ë°©ë¬¸ìëŠ” ì²­ë¡ìƒ‰
                        }
                        if (visitorsDescription) {
                            visitorsDescription.textContent = 'ì§€ë‚œ 24ì‹œê°„ (í´ë¦­í•˜ì—¬ ìƒì„¸ë³´ê¸°)';
                        }
                    }
                } else {
                    console.log('ë°©ë¬¸ì ë°ì´í„° ë¡œë”© ì‹¤íŒ¨');
                }
            })
            .catch(error => {
                console.log('ë°©ë¬¸ì ë°ì´í„° ë¡œë”© ì¤‘ ì˜¤ë¥˜:', error);
            });
    }
    
    // í”¼ë“œë°± ì¹´ë“œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ê°„ì†Œí™”)
    function updateFeedbackCard() {
        // í”¼ë“œë°± ë°ì´í„° API í˜¸ì¶œ
        fetch('/api/feedback_stats')
            .then(response => response.json())
            .then(feedbackData => {
                if (feedbackData.success) {
                    console.log('í”¼ë“œë°± ë°ì´í„° ì²˜ë¦¬ ì¤‘:', feedbackData);
                    
                    // ìƒë‹¨ ì¹´ë“œì˜ ì‚¬ìš©ì ë§Œì¡±ë„ ì—…ë°ì´íŠ¸
                    const total = (feedbackData.positive_count || 0) + (feedbackData.negative_count || 0);
                    const satisfactionRate = total > 0 ? Math.round((feedbackData.positive_count || 0) / total * 100) : 0;
                    
                    // ì‚¬ìš©ì ë§Œì¡±ë„ í¼ì„¼íŠ¸ ì—…ë°ì´íŠ¸
                    const positivePercentageElement = document.getElementById('positive-percentage');
                    if (positivePercentageElement) {
                        positivePercentageElement.textContent = `${satisfactionRate}%`;
                    }
                    
                    // ì‚¬ìš©ì ë§Œì¡±ë„ ê±´ìˆ˜ í‘œì‹œ ì¶”ê°€
                    const positiveCountDisplayElement = document.getElementById('positive-count-display');
                    if (positiveCountDisplayElement) {
                        positiveCountDisplayElement.textContent = `${feedbackData.positive_count || 0}ê±´ (í´ë¦­í•˜ì—¬ ìƒì„¸ë³´ê¸°)`;
                    }
                    
                    // ìµœê·¼ ë°©ë¬¸ì ìˆ˜ ì—…ë°ì´íŠ¸ (ë°©ë¬¸ì APIì—ì„œ ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°)
                    // updateVisitorCard(); // ì¤‘ë³µ ì œê±° - updateSummaryStatsì—ì„œ ì´ë¯¸ í˜¸ì¶œí•¨
                } else {
                    console.log('í”¼ë“œë°± ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', feedbackData);
                }
            })
            .catch(error => {
                console.log('í”¼ë“œë°± ë°ì´í„° ë¡œë”© ì¤‘ ì˜¤ë¥˜:', error);
            });
    }
    

    
    // Top ì¿¼ë¦¬ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
    function updateTopQueriesChart(topQueries) {
        const ctx = document.getElementById('top-queries-chart').getContext('2d');
        
        // ë°ì´í„° ì—†ìŒ ì²˜ë¦¬
        if (topQueries.length === 0) {
            if (topQueriesChart) {
                topQueriesChart.destroy();
                topQueriesChart = null;
            }
            // ì°¨íŠ¸ ì˜ì—­ì— 'ë°ì´í„° ì—†ìŒ' ë©”ì‹œì§€ í‘œì‹œ (í•„ìš”ì‹œ êµ¬í˜„)
            return;
        }
        
        // ì°¨íŠ¸ ë°ì´í„° ì¤€ë¹„
        const labels = topQueries.map(query => {
            // ì§ˆë¬¸ì´ ë„ˆë¬´ ê¸¸ë©´ ì˜ë¼ì„œ í‘œì‹œ
            const maxLength = 30;
            return query.query_text.length > maxLength 
                ? query.query_text.substring(0, maxLength) + '...'
                : query.query_text;
        });
        
        const counts = topQueries.map(query => query.count);
        
        // ì°¨íŠ¸ ì„¤ì •
        const chartData = {
            labels: labels,
            datasets: [{
                label: 'ì§ˆë¬¸ íšŸìˆ˜',
                data: counts,
                backgroundColor: 'rgba(48, 80, 122, 0.7)',
                borderColor: 'rgba(48, 80, 122, 1)',
                borderWidth: 1
            }]
        };
        
        const chartOptions = {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        title: function(tooltipItems) {
                            const idx = tooltipItems[0].dataIndex;
                            return topQueries[idx].query_text;
                        }
                    }
                }
            },
            scales: {
                x: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'ì§ˆë¬¸ íšŸìˆ˜'
                    }
                }
            }
        };
        
        // ì°¨íŠ¸ ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸
        if (topQueriesChart) {
            topQueriesChart.data = chartData;
            topQueriesChart.options = chartOptions;
            topQueriesChart.update();
        } else {
            topQueriesChart = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: chartOptions
            });
        }
    }
    

});

// ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€ ê¸°ëŠ¥
document.querySelector('.mobile-menu-btn').addEventListener('click', function() {
    document.querySelector('.nav-links').classList.toggle('active');
    this.classList.toggle('active');
});

// í…Œë§ˆ í† ê¸€ ê¸°ëŠ¥ (ë©”ì¸ í˜ì´ì§€ì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ìˆ˜ì •)
document.getElementById('theme-toggle').addEventListener('click', function() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    
    // ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
    updateThemeIcon(newTheme);
});

// í…Œë§ˆ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updateThemeIcon(theme) {
    const sunIcon = document.querySelector('.sun-icon');
    const moonIcon = document.querySelector('.moon-icon');
    
    if (theme === 'dark') {
        sunIcon.style.display = 'block';
        moonIcon.style.display = 'none';
    } else {
        sunIcon.style.display = 'none';
        moonIcon.style.display = 'block';
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ í…Œë§ˆ ì ìš©
const savedTheme = localStorage.getItem('theme') || 'light';
document.documentElement.setAttribute('data-theme', savedTheme);
updateThemeIcon(savedTheme);

// ì „ì—­ ë‚ ì§œ/ì‹œê°„ í¬ë§·íŒ… í•¨ìˆ˜
function formatDateTime(timestamp) {
    if (!timestamp) return 'ì‹œê°„ ì •ë³´ ì—†ìŒ';
    
    try {
        const date = new Date(timestamp);
        if (isNaN(date.getTime())) return 'ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œ';
        
        return date.toLocaleString('ko-KR', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
        });
    } catch (e) {
        console.log('ë‚ ì§œ ë³€í™˜ ì˜¤ë¥˜:', e);
        return 'ë‚ ì§œ í˜•ì‹ ì˜¤ë¥˜';
    }
}

// ìƒˆë¡œìš´ ë°©ë¬¸ì ëª¨ë‹¬ í•¨ìˆ˜
function openVisitorModal() {
    console.log('ë°©ë¬¸ì ëª¨ë‹¬ ì—´ê¸° ì‹œì‘');
    
    // ëª¨ë‹¬ ì—˜ë¦¬ë¨¼íŠ¸ ì°¾ê¸°
    const modalElement = document.getElementById('visitorDetailsModal');
    if (!modalElement) {
        alert('ë°©ë¬¸ì ëª¨ë‹¬ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    // ëª¨ë‹¬ í‘œì‹œ
    const modal = new bootstrap.Modal(modalElement);
    modal.show();
    
    // ë¡œë”© ìƒíƒœ ì„¤ì •
    document.getElementById('total-unique-ips').textContent = 'ë¡œë”©...';
    document.getElementById('total-visit-count').textContent = 'ë¡œë”©...';
    
    const ipStatsBody = document.getElementById('ip-stats-tbody');
    const visitorRecordsBody = document.getElementById('visitor-records-tbody');
    
    ipStatsBody.innerHTML = '<tr><td colspan="5" class="text-center">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>';
    visitorRecordsBody.innerHTML = '<tr><td colspan="3" class="text-center">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>';
    
    // API í˜¸ì¶œ
    fetch('/api/visitor_details')
        .then(response => {
            console.log('API ì‘ë‹µ ìƒíƒœ:', response.status);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('ë°©ë¬¸ì ë°ì´í„° ìˆ˜ì‹ :', data);
            
            if (data && data.success) {
                // í†µê³„ ì—…ë°ì´íŠ¸ (ë°©ë¬¸ì ëª¨ë‹¬ ì „ìš© - ë‹¤ë¥¸ ëª¨ë‹¬ì— ì˜í–¥ ì—†ìŒ)
                // IP í†µê³„ì—ì„œ ì‹¤ì œ ê³ ìœ  IP ìˆ˜ ê³„ì‚°
                const actualUniqueIPs = data.ip_statistics ? data.ip_statistics.length : 0;
                document.getElementById('total-unique-ips').textContent = actualUniqueIPs;
                document.getElementById('total-visit-count').textContent = (data.visitor_records && data.visitor_records.length) || 0;
                
                // IP í†µê³„ í…Œì´ë¸” ì—…ë°ì´íŠ¸
                ipStatsBody.innerHTML = '';
                if (data.ip_statistics && data.ip_statistics.length > 0) {
                    data.ip_statistics.forEach(stat => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td><code>${stat.ip}</code></td>
                            <td><span class="badge bg-primary">${stat.visit_count}</span></td>
                            <td><small>${stat.pages ? stat.pages.join(', ') : 'ì•Œ ìˆ˜ ì—†ìŒ'}</small></td>
                            <td><small>${formatDateTime(stat.first_visit)}</small></td>
                            <td><small>${formatDateTime(stat.last_visit)}</small></td>
                        `;
                        ipStatsBody.appendChild(row);
                    });
                } else {
                    ipStatsBody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">IP í†µê³„ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                }
                
                // ë°©ë¬¸ ê¸°ë¡ í…Œì´ë¸” ì—…ë°ì´íŠ¸
                visitorRecordsBody.innerHTML = '';
                if (data.visitor_records && data.visitor_records.length > 0) {
                    data.visitor_records.slice(0, 50).forEach(record => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td><small>${formatDateTime(record.timestamp)}</small></td>
                            <td><code>${record.ip}</code></td>
                            <td><small>${record.page}</small></td>
                        `;
                        visitorRecordsBody.appendChild(row);
                    });
                } else {
                    visitorRecordsBody.innerHTML = '<tr><td colspan="3" class="text-center text-muted">ë°©ë¬¸ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                }
            } else {
                // ì˜¤ë¥˜ ìƒíƒœ
                document.getElementById('total-unique-ips').textContent = 'ì˜¤ë¥˜';
                document.getElementById('total-visit-count').textContent = 'ì˜¤ë¥˜';
                ipStatsBody.innerHTML = '<tr><td colspan="5" class="text-center text-danger">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                visitorRecordsBody.innerHTML = '<tr><td colspan="3" class="text-center text-danger">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            }
        })
        .catch(error => {
            console.log('ë°©ë¬¸ì ë°ì´í„° ë¡œë“œ ì¤‘ ë¬¸ì œ ë°œìƒ:', error);
            // ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ì˜¤ë¥˜ ë°©ì§€
            document.getElementById('total-unique-ips').textContent = '0';
            document.getElementById('total-visit-count').textContent = '0';
            ipStatsBody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</td></tr>';
            visitorRecordsBody.innerHTML = '<tr><td colspan="3" class="text-center text-muted">ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</td></tr>';
            
            // ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„
            setTimeout(() => {
                location.reload();
            }, 2000);
        });
}

// ì‚¬ìš©ì ë§Œì¡±ë„ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ í•¨ìˆ˜
function showSatisfactionDetails() {
    fetch('/api/satisfaction_details')
        .then(response => response.json())
        .then(data => {
            console.log('ë§Œì¡±ë„ ìƒì„¸ ë°ì´í„°:', data);
            
            if (data.success) {
                // í†µê³„ ì—…ë°ì´íŠ¸
                document.getElementById('total-feedback-count').textContent = data.statistics.total_count;
                document.getElementById('positive-feedback-count').textContent = data.statistics.positive_count;
                document.getElementById('negative-feedback-count').textContent = data.statistics.negative_count;
                document.getElementById('satisfaction-rate-detail').textContent = data.statistics.satisfaction_rate + '%';
                
                const totalCount = data.statistics.total_count;
                if (totalCount > 0) {
                    const positivePercent = Math.round((data.statistics.positive_count / totalCount) * 100);
                    const negativePercent = Math.round((data.statistics.negative_count / totalCount) * 100);
                    document.getElementById('positive-percentage-detail').textContent = `${positivePercent}%`;
                    document.getElementById('negative-percentage-detail').textContent = `${negativePercent}%`;
                }
                
                // ê°œì„ í•„ìš” í”¼ë“œë°± í…Œì´ë¸” ì—…ë°ì´íŠ¸
                const negativeTbody = document.getElementById('negative-feedback-tbody');
                negativeTbody.innerHTML = '';
                
                if (data.negative_feedback && data.negative_feedback.length > 0) {
                    data.negative_feedback.forEach(feedback => {
                        const row = document.createElement('tr');
                        const shortQuery = feedback.query.length > 50 ? 
                            feedback.query.substring(0, 50) + '...' : feedback.query;
                        const date = new Date(feedback.timestamp);
                        const formattedTime = date.toLocaleDateString('ko-KR') + ' ' + 
                            date.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
                        
                        row.innerHTML = `
                            <td><small>${formattedTime}</small></td>
                            <td title="${feedback.query}">${shortQuery}</td>
                            <td>
                                <button class="btn btn-outline-danger btn-sm" onclick="deleteFeedback(${feedback.id})" title="ì‚­ì œ">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        `;
                        negativeTbody.appendChild(row);
                    });
                } else {
                    negativeTbody.innerHTML = '<tr><td colspan="3" class="text-center text-muted">ê°œì„ í•„ìš” í”¼ë“œë°±ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                }
                
                // ë§Œì¡± í”¼ë“œë°± í…Œì´ë¸” ì—…ë°ì´íŠ¸  
                const positiveTbody = document.getElementById('positive-feedback-tbody');
                positiveTbody.innerHTML = '';
                
                if (data.positive_feedback && data.positive_feedback.length > 0) {
                    data.positive_feedback.forEach(feedback => {
                        const row = document.createElement('tr');
                        const shortQuery = feedback.query.length > 50 ? 
                            feedback.query.substring(0, 50) + '...' : feedback.query;
                        const date = new Date(feedback.timestamp);
                        const formattedTime = date.toLocaleDateString('ko-KR') + ' ' + 
                            date.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
                        
                        row.innerHTML = `
                            <td><small>${formattedTime}</small></td>
                            <td title="${feedback.query}">${shortQuery}</td>
                        `;
                        positiveTbody.appendChild(row);
                    });
                } else {
                    positiveTbody.innerHTML = '<tr><td colspan="2" class="text-center text-muted">ë§Œì¡± í”¼ë“œë°±ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                }
                
                // ì°¨íŠ¸ ìƒì„±
                createFeedbackTrendChart(data.daily_trends);
                
                // ëª¨ë‹¬ í‘œì‹œ
                const modal = new bootstrap.Modal(document.getElementById('satisfactionDetailsModal'));
                modal.show();
            } else {
                console.error('ë§Œì¡±ë„ ìƒì„¸ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', data.error);
                alert('ë§Œì¡±ë„ ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        })
        .catch(error => {
            console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
            alert('ì„œë²„ ì—°ê²°ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
}

// í”¼ë“œë°± ì¶”ì´ ì°¨íŠ¸ ìƒì„±
let feedbackChart = null;
function createFeedbackTrendChart(dailyTrends) {
    const ctx = document.getElementById('feedbackTrendChart').getContext('2d');
    
    // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ ì œê±°
    if (feedbackChart) {
        feedbackChart.destroy();
    }
    
    const labels = dailyTrends.map(trend => {
        const date = new Date(trend.date);
        return date.toLocaleDateString('ko-KR', {month: 'short', day: 'numeric'});
    });
    
    feedbackChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'ë§Œì¡±í•´ìš”',
                data: dailyTrends.map(trend => trend.positive),
                borderColor: '#28a745',
                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                tension: 0.4,
                fill: true
            }, {
                label: 'ê°œì„ í•„ìš”',
                data: dailyTrends.map(trend => trend.negative),
                borderColor: '#dc3545',
                backgroundColor: 'rgba(220, 53, 69, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            },
            plugins: {
                legend: {
                    position: 'top'
                },
                tooltip: {
                    mode: 'index',
                    intersect: false
                }
            }
        }
    });
}

// ë§Œì¡±ë„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
function refreshSatisfactionData() {
    showSatisfactionDetails();
}

// í”¼ë“œë°± ì‚­ì œ í•¨ìˆ˜
function deleteFeedback(feedbackId) {
    if (confirm('ì´ í”¼ë“œë°±ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        fetch('/api/delete_feedback', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                feedback_id: feedbackId
            })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                alert('í”¼ë“œë°±ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                // ë§Œì¡±ë„ ìƒì„¸ ì •ë³´ ë‹¤ì‹œ ë¡œë“œ
                showSatisfactionDetails();
                // ëŒ€ì‹œë³´ë“œ ë©”ì¸ ì¹´ë“œë„ ì—…ë°ì´íŠ¸
                updateFeedbackCard();
            } else {
                alert('í”¼ë“œë°± ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            }
        })
        .catch(error => {
            console.error('í”¼ë“œë°± ì‚­ì œ ì˜¤ë¥˜:', error);
            alert('í”¼ë“œë°± ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        });
    }
}

// ì „ì²´ ì§ˆë¬¸ ìˆ˜ ìƒì„¸ ì •ë³´ í‘œì‹œ
function showQueriesDetails() {
    fetch('/api/top_queries?period=all&category=&limit=50')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('ì§ˆë¬¸ ë°ì´í„°:', data); // ë””ë²„ê¹…ìš©
            if (data.success && data.top_queries) {
                const queries = data.top_queries;
                let modalContent = `
                    <div class="modal fade" id="queriesModal" tabindex="-1">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header" style="background-color: #30507A;">
                                    <h5 class="modal-title text-white">
                                        ğŸ“Š ì „ì²´ ì§ˆë¬¸ ìƒì„¸ í˜„í™©
                                    </h5>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <div class="card text-center border-0" style="background-color: #f8f9fa;">
                                                <div class="card-body">
                                                    <h6 class="card-title text-primary">ì´ ì§ˆë¬¸ ìˆ˜</h6>
                                                    <h4 class="text-primary">${queries.length}ê±´</h4>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card text-center border-0" style="background-color: #f8f9fa;">
                                                <div class="card-body">
                                                    <h6 class="card-title text-success">ìµœë‹¤ ì§ˆë¬¸</h6>
                                                    <small class="text-success">${queries.length > 0 ? queries[0].query_text.substring(0, 25) + (queries[0].query_text.length > 25 ? '...' : '') + ' (' + queries[0].count + 'íšŒ)' : 'ë°ì´í„° ì—†ìŒ'}</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <h6 class="mb-3">ğŸ“‹ ìµœê·¼ ì§ˆë¬¸ ëª©ë¡ (ìµœì‹  50ê°œ)</h6>
                                    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                        <table class="table table-striped table-hover">
                                            <thead style="background-color: #f8f9fa; position: sticky; top: 0;">
                                                <tr>
                                                    <th style="color: #30507A;">ìˆœìœ„</th>
                                                    <th style="color: #30507A;">ì§ˆë¬¸ ë‚´ìš©</th>
                                                    <th style="color: #30507A;">íšŸìˆ˜</th>
                                                    <th style="color: #30507A;">ìµœê·¼ ì§ˆë¬¸ ì‹œê°„</th>
                                                </tr>
                                            </thead>
                                            <tbody>`;
                
                queries.forEach((query, index) => {
                    // ë‹¤ì–‘í•œ ì‹œê°„ í•„ë“œëª… í™•ì¸í•˜ì—¬ ë‚ ì§œ ì²˜ë¦¬ (ì „ì²´ ì§ˆë¬¸ ëª¨ë‹¬ ì „ìš©)
                    let timestamp = 'ì‹œê°„ ì •ë³´ ì—†ìŒ';
                    const timeField = query.latest_timestamp || query.last_asked || query.timestamp || query.last_timestamp;
                    
                    if (timeField) {
                        try {
                            const date = new Date(timeField);
                            if (!isNaN(date.getTime())) {
                                timestamp = date.toLocaleString('ko-KR', {
                                    year: 'numeric',
                                    month: '2-digit',
                                    day: '2-digit',
                                    hour: '2-digit',
                                    minute: '2-digit'
                                });
                            }
                        } catch (e) {
                            console.log('ì „ì²´ ì§ˆë¬¸ ëª¨ë‹¬ ë‚ ì§œ ë³€í™˜ ì˜¤ë¥˜:', e);
                        }
                    }
                    
                    modalContent += `
                        <tr>
                            <td><span class="badge bg-primary">${index + 1}</span></td>
                            <td>${query.query_text}</td>
                            <td><span class="badge bg-success">${query.count}íšŒ</span></td>
                            <td><small class="text-muted">${timestamp}</small></td>
                        </tr>`;
                });
                
                modalContent += `
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                                    <button type="button" class="btn btn-primary" onclick="showQueriesDetails()" style="background-color: #30507A; border-color: #30507A;">
                                        ğŸ”„ ìƒˆë¡œê³ ì¹¨
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>`;
                
                // ê¸°ì¡´ ëª¨ë‹¬ ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€
                const existingModal = document.getElementById('queriesModal');
                if (existingModal) {
                    existingModal.remove();
                }
                
                document.body.insertAdjacentHTML('beforeend', modalContent);
                const modal = new bootstrap.Modal(document.getElementById('queriesModal'));
                modal.show();
            } else {
                console.log('ì§ˆë¬¸ ë°ì´í„° ì˜¤ë¥˜:', data);
                alert('ì§ˆë¬¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            }
        })
        .catch(error => {
            console.error('ì§ˆë¬¸ ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
            alert('ì„œë²„ ì—°ê²°ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ë°©ë¬¸ì ì¹´ë“œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    // ë°©ë¬¸ì ì¹´ë“œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
    setTimeout(updateVisitorCard, 1000); // 1ì´ˆ í›„ ì‹¤í–‰
});

// í˜ì´ì§€ê°€ ì™„ì „íˆ ë¡œë“œëœ í›„ì—ë„ ì‹¤í–‰
window.addEventListener('load', function() {
    setTimeout(updateVisitorCard, 500); // 0.5ì´ˆ í›„ ì‹¤í–‰
});

// ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ í´ë¦­ ì‹œ ëª¨ë°”ì¼ ë©”ë‰´ ë‹«ê¸°
document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', () => {
        document.querySelector('.nav-links').classList.remove('active');
        document.querySelector('.mobile-menu-btn').classList.remove('active');
    });
});
</script>

<!-- Bootstrap JS ì¶”ê°€ -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>