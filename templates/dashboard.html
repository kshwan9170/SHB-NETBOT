<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHB-NetBot ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modern.css') }}">
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Bootstrap CSS ì¶”ê°€ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ ê°•í™” -->
    <style>
        /* ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ ê°•í™” - ë©”ì¸ í˜ì´ì§€ì™€ ë™ì¼í•˜ê²Œ */
        .navbar {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            z-index: 1000 !important;
            background-color: #1A2B4C !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
            padding: 1rem 0 !important;
        }
        
        .navbar-container {
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            max-width: 1200px !important;
            margin: 0 auto !important;
            padding: 0 2rem !important;
            height: 70px !important;
        }
        
        .logo {
            display: flex !important;
            align-items: center !important;
            gap: 0.75rem !important;
            height: 3.2rem !important;
            margin-right: 3rem !important; /* ë¡œê³ ì™€ ë„¤ë¹„ê²Œì´ì…˜ ê°„ ì—¬ë°± ì¶”ê°€ */
        }
        
        .logo span {
            font-size: 1.8rem !important;
            font-weight: 600 !important;
            color: #FFFFFF !important;
            letter-spacing: -0.5px !important;
            line-height: 3.2rem !important;
            display: flex !important;
            align-items: center !important;
        }
        
        .bot-name {
            font-size: 1.8rem !important;
            font-weight: 600 !important;
            color: #FFFFFF !important;
            line-height: 3.2rem !important;
            display: flex !important;
            align-items: center !important;
            margin-left: 0.75rem !important;
        }
        
        .nav-links {
            display: flex !important;
            align-items: center !important;
            gap: 3rem !important;
        }
        
        .nav-link {
            color: #FFFFFF !important;
            font-weight: 600 !important; /* ê¸€ì êµµê¸° í•œ ë‹¨ê³„ ì˜¬ë¦¼ */
            font-size: 1.5rem !important; /* í¬ê¸°ëŠ” ì›ë˜ëŒ€ë¡œ */
            position: relative !important;
            transition: all 0.2s !important;
            text-decoration: none !important;
        }
        
        .nav-link:hover,
        .nav-link.active {
            color: #BFD7FF !important;
        }
        
        .nav-link::after {
            content: '' !important;
            position: absolute !important;
            bottom: -0.8rem !important;
            left: 0 !important;
            width: 0 !important;
            height: 2px !important;
            background-color: #BFD7FF !important;
            transition: width 0.3s !important;
        }
        
        .nav-link:hover::after,
        .nav-link.active::after {
            width: 100% !important;
        }
        
        .theme-toggle {
            background: none !important;
            border: none !important;
            color: #FFFFFF !important;
            cursor: pointer !important;
            padding: 0.5rem !important;
            border-radius: 50% !important;
            transition: background-color 0.2s !important;
        }
        
        .theme-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1) !important;
        }
        
        /* ëª¨ë°”ì¼ ë©”ë‰´ ë²„íŠ¼ */
        .mobile-menu-btn {
            display: none !important;
            flex-direction: column !important;
            cursor: pointer !important;
            gap: 0.3rem !important;
        }
        
        .mobile-menu-btn .bar {
            width: 2.5rem !important;
            height: 0.3rem !important;
            background-color: #FFFFFF !important;
            transition: all 0.3s !important;
        }
        
        /* ë©”ì¸ ì½˜í…ì¸  ìƒë‹¨ ì—¬ë°± ì¡°ì • */
        .container.my-5 {
            margin-top: 100px !important;
        }
        
        /* ë°˜ì‘í˜• ì²˜ë¦¬ */
        @media (max-width: 768px) {
            .nav-links {
                display: none !important;
            }
            
            .mobile-menu-btn {
                display: flex !important;
            }
        }
    </style>
</head>
<body>
    <!-- ê³ ì • ë‚´ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="logo">
                <img src="{{ url_for('static', filename='images/shinhan_logo_new.png') }}" alt="ì‹ í•œì€í–‰ ë¡œê³ " class="logo-img shinhan-logo-white">
                <span>ì‹ í•œì€í–‰</span>
                <span class="bot-name">SHB-NetBot</span>
            </div>
            <div class="nav-links">
                <a href="/#home" class="nav-link">Home</a>
                <a href="/#about" class="nav-link">About</a>
                <a href="/#chat" class="nav-link">Chat</a>
                <a href="/#documents" class="nav-link">Documents</a>
                <a href="/dashboard" class="nav-link active">Dashboard</a>
                <a href="/#support" class="nav-link">Support</a>
                <button id="theme-toggle" class="theme-toggle">
                    <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </div>
            <div class="mobile-menu-btn">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <!-- í—¤ë” ì˜ì—­ -->
        <div class="text-center mb-5">
            <h1 class="display-4" style="color: #30507A; font-family: 'Inter', sans-serif; font-weight: 600;">SHB-NetBot ëŒ€ì‹œë³´ë“œ</h1>
            <p class="lead" style="color: #5A6373; font-family: 'Inter', sans-serif; font-weight: 400;">ì‹¤ì‹œê°„ ì‚¬ìš©ì ë¬¸ì˜ ë° í†µê³„ ë¶„ì„</p>
        </div>
    
    <!-- í•„í„° ì˜ì—­ -->
    <div class="card mb-4 shadow-sm" style="border-color: #E6EBF4;">
        <div class="card-body">
            <h5 class="card-title" style="color: #30507A; font-family: 'Inter', sans-serif; font-weight: 600;">ì¡°íšŒ í•„í„°</h5>
            <div class="row align-items-end">
                <div class="col-md-4 mb-3">
                    <label for="period-select" class="form-label" style="font-family: 'Inter', sans-serif; font-weight: 500;">ê¸°ê°„</label>
                    <select id="period-select" class="form-select" style="font-family: 'Inter', sans-serif; font-weight: 400;">
                        <option value="all" selected>ì „ì²´ ê¸°ê°„</option>
                        <option value="day">ì˜¤ëŠ˜</option>
                        <option value="week">ìµœê·¼ 7ì¼</option>
                        <option value="month">ìµœê·¼ 30ì¼</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="category-select" class="form-label" style="font-family: 'Inter', sans-serif; font-weight: 500;">ì¹´í…Œê³ ë¦¬</label>
                    <select id="category-select" class="form-select" style="font-family: 'Inter', sans-serif; font-weight: 400;">
                        <option value="" selected>ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                        <!-- ì¹´í…Œê³ ë¦¬ ì˜µì…˜ì€ JavaScriptë¡œ ë™ì  ìƒì„± -->
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <button id="refresh-button" class="btn btn-primary w-100" style="background-color: #30507A; border-color: #30507A; font-family: 'Inter', sans-serif; font-weight: 500;">
                        <i class="fas fa-sync-alt me-2"></i> ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- í†µê³„ ìš”ì•½ ì¹´ë“œ -->
    <div class="row mb-4">
        <!-- ì „ì²´ ì§ˆë¬¸ ìˆ˜ -->
        <div class="col-md-4 mb-3">
            <div class="card h-100 shadow-sm" style="border-color: #E6EBF4;">
                <div class="card-body text-center">
                    <h5 class="card-title" style="color: #30507A;">ì „ì²´ ì§ˆë¬¸ ìˆ˜</h5>
                    <div class="d-flex align-items-center justify-content-center">
                        <i class="fas fa-comments fa-3x me-3" style="color: #30507A;"></i>
                        <div class="display-4 fw-bold" id="total-queries">0</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ìµœê·¼ ë°©ë¬¸ì -->
        <div class="col-md-4 mb-3">
            <div class="card h-100 shadow-sm" style="border-color: #E6EBF4;">
                <div class="card-body text-center">
                    <h5 class="card-title" style="color: #30507A;">ìµœê·¼ ë°©ë¬¸ì</h5>
                    <div class="d-flex align-items-center justify-content-center">
                        <i class="fas fa-users fa-3x me-3" id="visitors-icon" style="color: #17a2b8;"></i>
                        <div class="display-4 fw-bold" id="recent-visitors">-</div>
                    </div>
                    <div class="small text-muted" id="visitors-description">ì§€ë‚œ 24ì‹œê°„</div>
                </div>
            </div>
        </div>
        
        <!-- ì‚¬ìš©ì ë§Œì¡±ë„ -->
        <div class="col-md-4 mb-3">
            <div class="card h-100 shadow-sm" style="border-color: #E6EBF4;">
                <div class="card-body text-center">
                    <h5 class="card-title" style="color: #30507A;">ì‚¬ìš©ì ë§Œì¡±ë„</h5>
                    <div class="d-flex align-items-center justify-content-center">
                        <i class="fas fa-smile fa-3x me-3" style="color: #ffc107;"></i>
                        <div>
                            <div class="display-4 fw-bold" id="positive-percentage">0%</div>
                            <small class="text-muted" id="positive-count-display">0ê±´</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ë¶€ì • í”¼ë“œë°± ì¹´ë“œ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm" style="border-color: #E6EBF4;">
                <div class="card-body">
                    <h5 class="card-title" style="color: #30507A; font-family: 'Inter', sans-serif; font-weight: 600;">
                        ê°œì„ í•„ìš” í”¼ë“œë°± ë¶„ì„
                    </h5>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="text-center">
                                <div class="display-6 fw-bold" style="color: #dc3545;" id="negative-feedback-count">0</div>
                                <small class="text-muted" style="font-family: 'Inter', sans-serif; font-weight: 400;">ê°œì„ í•„ìš” ì‘ë‹µ</small>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="text-center">
                                <div class="display-6 fw-bold" style="color: #28a745;" id="positive-feedback-count">0</div>
                                <small class="text-muted" style="font-family: 'Inter', sans-serif; font-weight: 400;">ë§Œì¡±í•´ìš” ì‘ë‹µ</small>
                            </div>
                        </div>

                    </div>
                    <div class="mt-3">
                        <h6 style="color: #30507A; font-family: 'Inter', sans-serif; font-weight: 600;">ìµœê·¼ ê°œì„ í•„ìš” í”¼ë“œë°±</h6>
                        <div id="recent-negative-feedback" class="list-group list-group-flush">
                            <!-- ë¶€ì • í”¼ë“œë°± ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ì£¼ìš” ë¬¸ì˜ TOP 10 ì°¨íŠ¸ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm" style="border-color: #E6EBF4;">
                <div class="card-body">
                    <h5 class="card-title" style="color: #30507A; font-family: 'Inter', sans-serif; font-weight: 600;">ì£¼ìš” ë¬¸ì˜ TOP 10</h5>
                    <div class="chart-container" style="position: relative; height:400px;">
                        <canvas id="top-queries-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ìƒì„¸ ë°ì´í„° í…Œì´ë¸” -->
    <div class="card shadow-sm" style="border-color: #E6EBF4;">
        <div class="card-body">
            <h5 class="card-title" style="color: #30507A; font-family: 'Inter', sans-serif; font-weight: 600;">ìƒì„¸ ë¬¸ì˜ ë°ì´í„°</h5>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead style="background-color: #F8F9FA;">
                        <tr>
                            <th scope="col" style="font-family: 'Inter', sans-serif; font-weight: 600;">#</th>
                            <th scope="col" style="font-family: 'Inter', sans-serif; font-weight: 600;">ì§ˆë¬¸ ë‚´ìš©</th>
                            <th scope="col" style="font-family: 'Inter', sans-serif; font-weight: 600;">ì¹´í…Œê³ ë¦¬</th>
                            <th scope="col" style="font-family: 'Inter', sans-serif; font-weight: 600;">ì§ˆë¬¸ íšŸìˆ˜</th>
                            <th scope="col" style="font-family: 'Inter', sans-serif; font-weight: 600;">ìµœì´ˆ ì§ˆë¬¸ì¼</th>
                            <th scope="col" style="font-family: 'Inter', sans-serif; font-weight: 600;">ìµœê·¼ ì§ˆë¬¸ì¼</th>
                        </tr>
                    </thead>
                    <tbody id="query-table-body">
                        <!-- ë°ì´í„°ëŠ” JavaScriptë¡œ ë™ì  ìƒì„± -->
                    </tbody>
                </table>
            </div>
            <div id="no-data-message" class="text-center py-4 d-none">
                <p class="text-muted" style="font-family: 'Inter', sans-serif; font-weight: 400;">ì¡°íšŒëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </div>
    </div>
</div>

<!-- í‘¸í„° ì„¹ì…˜ -->
<footer class="footer">
    <div class="footer-container">
        <div class="footer-content">
            <div class="footer-grid">
                <div class="footer-col">
                    <h3>ì„œë¹„ìŠ¤</h3>
                    <div class="footer-links">
                        <a href="#home" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                            í™ˆ
                        </a>
                        <a href="#about" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                            ì†Œê°œ
                        </a>
                        <a href="#chat" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            ëŒ€í™”í•˜ê¸°
                        </a>
                        <a href="#documents" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                            ë¬¸ì„œ
                        </a>
                    </div>
                </div>
                <div class="footer-col">
                    <h3>ê³ ê°ì§€ì›</h3>
                    <div class="footer-links">
                        <a href="/inquiry" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                            ë¬¸ì˜í•˜ê¸°
                        </a>
                        <a href="/feedback" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                            </svg>
                            í”¼ë“œë°±
                        </a>
                        <a href="/report" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                            ì‹ ê³ í•˜ê¸°
                        </a>
                        <a href="#dashboard" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            </svg>
                            ëŒ€ì‹œë³´ë“œ
                        </a>
                    </div>
                </div>
                <div class="footer-col">
                    <h3>ì •ë³´</h3>
                    <div class="footer-links">
                        <a href="/terms" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                            ì´ìš©ì•½ê´€
                        </a>
                        <a href="/privacy" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                            </svg>
                            ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨
                        </a>
                        <a href="/copyright" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M15 9.354a4 4 0 1 0 0 5.292"></path>
                            </svg>
                            ì €ì‘ê¶Œ
                        </a>
                        <a href="/security" class="footer-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                            </svg>
                            ë³´ì•ˆì •ì±…
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 ì‹ í•œì€í–‰. All rights reserved.</p>
        </div>
    </div>
</footer>

<!-- í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script defer src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<!-- Chart.js -->
<script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- AOS ì• ë‹ˆë©”ì´ì…˜ -->
<script defer src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script>
  AOS.init();
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // ì°¨íŠ¸ ê°ì²´ (ì´ˆê¸°í™” í›„ ë‚˜ì¤‘ì— ì—…ë°ì´íŠ¸)
    let topQueriesChart;
    
    // í˜ì´ì§€ ë¡œë“œì‹œ ë°ì´í„° ì¡°íšŒ
    refreshDashboard();
    
    // ë¶€ì • í”¼ë“œë°± ì¹´ë“œ ì´ˆê¸°í™”
    updateNegativeFeedbackCard();
    
    // ë°©ë¬¸ì ìˆ˜ ì§ì ‘ ì—…ë°ì´íŠ¸
    setTimeout(() => {
        fetch('/api/feedback_stats')
            .then(response => response.json())
            .then(data => {
                console.log('ë°©ë¬¸ì ìˆ˜ ì§ì ‘ ì—…ë°ì´íŠ¸:', data);
                const visitorsElement = document.getElementById('recent-visitors');
                if (visitorsElement && data.success && data.unique_visitors_24h !== undefined) {
                    visitorsElement.textContent = data.unique_visitors_24h;
                    console.log('ë°©ë¬¸ì ìˆ˜ ì„¤ì • ì™„ë£Œ:', data.unique_visitors_24h);
                }
            })
            .catch(error => console.error('ë°©ë¬¸ì ìˆ˜ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error));
    }, 2000);
    
    // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    document.getElementById('refresh-button').addEventListener('click', refreshDashboard);
    
    // í•„í„° ë³€ê²½ ì´ë²¤íŠ¸
    document.getElementById('period-select').addEventListener('change', refreshDashboard);
    document.getElementById('category-select').addEventListener('change', refreshDashboard);
    
    // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ì¡°íšŒ ë° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function refreshDashboard() {
        // ë¡œë”© í‘œì‹œ (í•„ìš”ì‹œ êµ¬í˜„)
        
        // í•„í„° ê°’ ê°€ì ¸ì˜¤ê¸°
        const period = document.getElementById('period-select').value;
        const category = document.getElementById('category-select').value;
        
        // API í˜¸ì¶œ
        fetch(`/api/top_queries?period=${period}&category=${category}&limit=10`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateDashboard(data);
                } else {
                    console.error('ë°ì´í„° ì¡°íšŒ ì˜¤ë¥˜:', data.error);
                    // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ (í•„ìš”ì‹œ êµ¬í˜„)
                }
            })
            .catch(error => {
                console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ (í•„ìš”ì‹œ êµ¬í˜„)
            });
    }
    
    // ëŒ€ì‹œë³´ë“œ UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateDashboard(data) {
        // ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ì—…ë°ì´íŠ¸
        updateCategoryOptions(data.category_stats);
        
        // í†µê³„ ìš”ì•½ ì—…ë°ì´íŠ¸
        updateSummaryStats(data);
        
        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        updateTopQueriesChart(data.top_queries);
        
        // í…Œì´ë¸” ì—…ë°ì´íŠ¸
        updateQueryTable(data.top_queries);
        
        // í”¼ë“œë°± í†µê³„ ì—…ë°ì´íŠ¸ (ìƒˆë¡œìš´ ê¸°ëŠ¥)
        updateFeedbackStats();
    }
    
    // ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ì—…ë°ì´íŠ¸
    function updateCategoryOptions(categoryStats) {
        const categorySelect = document.getElementById('category-select');
        const currentValue = categorySelect.value;
        
        // í˜„ì¬ ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ìœ ì§€í•˜ë©´ì„œ ëª©ë¡ ì—…ë°ì´íŠ¸
        // ì²« ë²ˆì§¸ ì˜µì…˜(ì „ì²´ ì¹´í…Œê³ ë¦¬)ëŠ” ìœ ì§€
        while (categorySelect.options.length > 1) {
            categorySelect.remove(1);
        }
        
        // ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ì¶”ê°€
        categoryStats.forEach(stat => {
            const option = document.createElement('option');
            option.value = stat.category;
            option.textContent = `${stat.category} (${stat.total_count})`;
            categorySelect.appendChild(option);
        });
        
        // ì´ì „ ì„ íƒ ê°’ ë³µì› (ì¡´ì¬í•˜ëŠ” ê²½ìš°)
        if (currentValue) {
            for (let i = 0; i < categorySelect.options.length; i++) {
                if (categorySelect.options[i].value === currentValue) {
                    categorySelect.selectedIndex = i;
                    break;
                }
            }
        }
    }
    
    // í†µê³„ ìš”ì•½ ì—…ë°ì´íŠ¸
    function updateSummaryStats(data) {
        // ì „ì²´ ì§ˆë¬¸ ìˆ˜
        document.getElementById('total-queries').textContent = 
            data.top_queries.reduce((sum, query) => sum + query.count, 0);
        
        // ë¶€ì • í”¼ë“œë°± ì¹´ë“œ ì—…ë°ì´íŠ¸ ë° ë°©ë¬¸ì ìˆ˜ ì—…ë°ì´íŠ¸
        updateNegativeFeedbackCard();
    }
    
    // ë¶€ì • í”¼ë“œë°± ì¹´ë“œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ê¸°ì¡´ ê¸°ëŠ¥ì— ì˜í–¥ ì—†ìŒ)
    function updateNegativeFeedbackCard() {
        // í”¼ë“œë°± ë°ì´í„° API í˜¸ì¶œ
        fetch('/api/feedback_stats')
            .then(response => response.json())
            .then(feedbackData => {
                if (feedbackData.success) {
                    console.log('í”¼ë“œë°± ë°ì´í„° ì²˜ë¦¬ ì¤‘:', feedbackData);
                    
                    // ë¶€ì • í”¼ë“œë°± ìˆ˜ - ìš”ì†Œ ì¡´ì¬ í™•ì¸
                    const negativeCountElement = document.getElementById('negative-feedback-count');
                    if (negativeCountElement) {
                        negativeCountElement.textContent = feedbackData.negative_count || 0;
                    }
                    
                    // ê¸ì • í”¼ë“œë°± ìˆ˜ (ì‚¬ìš©ì ë§Œì¡±ë„) - ìš”ì†Œ ì¡´ì¬ í™•ì¸
                    const positiveCountElement = document.getElementById('positive-feedback-count');
                    if (positiveCountElement) {
                        positiveCountElement.textContent = feedbackData.positive_count || 0;
                    }
                    
                    // ìƒë‹¨ ì¹´ë“œì˜ ì‚¬ìš©ì ë§Œì¡±ë„ ì—…ë°ì´íŠ¸
                    const total = (feedbackData.positive_count || 0) + (feedbackData.negative_count || 0);
                    const satisfactionRate = total > 0 ? Math.round((feedbackData.positive_count || 0) / total * 100) : 0;
                    
                    // ì‚¬ìš©ì ë§Œì¡±ë„ í¼ì„¼íŠ¸ ì—…ë°ì´íŠ¸
                    const positivePercentageElement = document.getElementById('positive-percentage');
                    if (positivePercentageElement) {
                        positivePercentageElement.textContent = `${satisfactionRate}%`;
                    }
                    
                    // ì‚¬ìš©ì ë§Œì¡±ë„ ê±´ìˆ˜ í‘œì‹œ ì¶”ê°€
                    const positiveCountDisplayElement = document.getElementById('positive-count-display');
                    if (positiveCountDisplayElement) {
                        positiveCountDisplayElement.textContent = `${feedbackData.positive_count || 0}ê±´`;
                    }
                    
                    // ìµœê·¼ ë°©ë¬¸ì ìˆ˜ ì—…ë°ì´íŠ¸ (ì‹¤ì œ API ê°’ ì‚¬ìš©)
                    const visitorsText = document.getElementById('recent-visitors');
                    const visitorsIcon = document.getElementById('visitors-icon');
                    const visitorsDescription = document.getElementById('visitors-description');
                    
                    if (visitorsText) {
                        // APIì—ì„œ ë°›ì€ ì‹¤ì œ ë°©ë¬¸ì ìˆ˜ í‘œì‹œ
                        const uniqueVisitors = feedbackData.unique_visitors_24h || 0;
                        console.log('ğŸ”” ë°©ë¬¸ì ìˆ˜ ì—…ë°ì´íŠ¸ ì‹œì‘!');
                        console.log('ğŸ“Š API ë°ì´í„°:', feedbackData);
                        console.log('ğŸ‘¥ ë°©ë¬¸ì ìˆ˜:', uniqueVisitors);
                        console.log('ğŸ” ìš”ì†Œ ì—…ë°ì´íŠ¸ ì „:', visitorsText.textContent);
                        visitorsText.textContent = uniqueVisitors;
                        console.log('âœ… ìš”ì†Œ ì—…ë°ì´íŠ¸ í›„:', visitorsText.textContent);
                        
                        // ê°•ì œë¡œ í™”ë©´ ê°±ì‹ 
                        visitorsText.style.color = '#007bff';
                        setTimeout(() => {
                            visitorsText.style.color = '';
                        }, 500);
                        
                        if (visitorsIcon) {
                            visitorsIcon.style.color = '#17a2b8'; // ë°©ë¬¸ìëŠ” ì²­ë¡ìƒ‰
                        }
                        if (visitorsDescription) {
                            visitorsDescription.textContent = 'ì§€ë‚œ 24ì‹œê°„';
                        }
                    }
                    
                    // í•˜ë‹¨ í”¼ë“œë°± ë¶„ì„ì˜ ë§Œì¡±ë„ ì—…ë°ì´íŠ¸
                    const rateElement = document.getElementById('feedback-improvement-rate');
                    if (rateElement) {
                        rateElement.textContent = `${satisfactionRate}%`;
                    }
                    
                    // ìµœê·¼ ë¶€ì • í”¼ë“œë°± ëª©ë¡ ì—…ë°ì´íŠ¸
                    updateRecentNegativeFeedback(feedbackData.recent_negative || []);
                } else {
                    console.log('í”¼ë“œë°± ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', feedbackData);
                }
            })
            .catch(error => {
                console.log('í”¼ë“œë°± ë°ì´í„° ë¡œë”© ì¤‘ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ê°’ ì„¤ì • - ìš”ì†Œ ì¡´ì¬ í™•ì¸
                const negativeElement = document.getElementById('negative-feedback-count');
                const positiveElement = document.getElementById('positive-feedback-count');
                const rateElement = document.getElementById('feedback-improvement-rate');
                
                if (negativeElement) negativeElement.textContent = '0';
                if (positiveElement) positiveElement.textContent = '0';
                if (rateElement) rateElement.textContent = '0%';
            });
    }
    
    // ìµœê·¼ ë¶€ì • í”¼ë“œë°± ëª©ë¡ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateRecentNegativeFeedback(recentFeedback) {
        const container = document.getElementById('recent-negative-feedback');
        container.innerHTML = '';
        
        if (recentFeedback.length === 0) {
            container.innerHTML = '<div class="text-muted text-center py-3">ìµœê·¼ ê°œì„ í•„ìš” í”¼ë“œë°±ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }
        
        recentFeedback.slice(0, 5).forEach((feedback, index) => {
            const feedbackItem = document.createElement('div');
            feedbackItem.className = 'list-group-item border-0 px-0';
            feedbackItem.innerHTML = `
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <p class="mb-1 text-truncate" style="max-width: 350px;">${feedback.question || 'ì§ˆë¬¸ ë‚´ìš© ì—†ìŒ'}</p>
                        <small class="text-muted">${feedback.timestamp || 'ì‹œê°„ ì •ë³´ ì—†ìŒ'}</small>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <span class="badge bg-danger">ê°œì„ í•„ìš”</span>
                        <button class="btn btn-sm btn-outline-danger delete-feedback-btn" 
                                data-question="${feedback.question}" 
                                data-timestamp="${feedback.timestamp}"
                                title="ì´ í”¼ë“œë°± ì‚­ì œ">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
            `;
            container.appendChild(feedbackItem);
        });
        
        // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.querySelectorAll('.delete-feedback-btn').forEach(button => {
            button.addEventListener('click', function() {
                const question = this.getAttribute('data-question');
                const timestamp = this.getAttribute('data-timestamp');
                deleteFeedback(question, timestamp);
            });
        });
    }
    
    // í”¼ë“œë°± ì‚­ì œ í•¨ìˆ˜
    function deleteFeedback(question, timestamp) {
        if (!confirm('ì´ í”¼ë“œë°±ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            return;
        }
        
        fetch('/api/feedback/delete', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                question: question,
                timestamp: timestamp
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // ì„±ê³µì‹œ í”¼ë“œë°± ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                updateNegativeFeedbackCard();
            } else {
                alert('í”¼ë“œë°± ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            }
        })
        .catch(error => {
            console.error('í”¼ë“œë°± ì‚­ì œ ì˜¤ë¥˜:', error);
            alert('í”¼ë“œë°± ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
    }
    
    // Top ì¿¼ë¦¬ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
    function updateTopQueriesChart(topQueries) {
        const ctx = document.getElementById('top-queries-chart').getContext('2d');
        
        // ë°ì´í„° ì—†ìŒ ì²˜ë¦¬
        if (topQueries.length === 0) {
            if (topQueriesChart) {
                topQueriesChart.destroy();
                topQueriesChart = null;
            }
            // ì°¨íŠ¸ ì˜ì—­ì— 'ë°ì´í„° ì—†ìŒ' ë©”ì‹œì§€ í‘œì‹œ (í•„ìš”ì‹œ êµ¬í˜„)
            return;
        }
        
        // ì°¨íŠ¸ ë°ì´í„° ì¤€ë¹„
        const labels = topQueries.map(query => {
            // ì§ˆë¬¸ì´ ë„ˆë¬´ ê¸¸ë©´ ì˜ë¼ì„œ í‘œì‹œ
            const maxLength = 30;
            return query.query_text.length > maxLength 
                ? query.query_text.substring(0, maxLength) + '...'
                : query.query_text;
        });
        
        const counts = topQueries.map(query => query.count);
        
        // ì°¨íŠ¸ ì„¤ì •
        const chartData = {
            labels: labels,
            datasets: [{
                label: 'ì§ˆë¬¸ íšŸìˆ˜',
                data: counts,
                backgroundColor: 'rgba(48, 80, 122, 0.7)',
                borderColor: 'rgba(48, 80, 122, 1)',
                borderWidth: 1
            }]
        };
        
        const chartOptions = {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        title: function(tooltipItems) {
                            const idx = tooltipItems[0].dataIndex;
                            return topQueries[idx].query_text;
                        }
                    }
                }
            },
            scales: {
                x: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'ì§ˆë¬¸ íšŸìˆ˜'
                    }
                }
            }
        };
        
        // ì°¨íŠ¸ ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸
        if (topQueriesChart) {
            topQueriesChart.data = chartData;
            topQueriesChart.options = chartOptions;
            topQueriesChart.update();
        } else {
            topQueriesChart = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: chartOptions
            });
        }
    }
    
    // ì¿¼ë¦¬ í…Œì´ë¸” ì—…ë°ì´íŠ¸
    function updateQueryTable(topQueries) {
        const tableBody = document.getElementById('query-table-body');
        const noDataMessage = document.getElementById('no-data-message');
        
        // í…Œì´ë¸” ë‚´ìš© ì´ˆê¸°í™”
        tableBody.innerHTML = '';
        
        // ë°ì´í„° ì—†ìŒ ì²˜ë¦¬
        if (topQueries.length === 0) {
            noDataMessage.classList.remove('d-none');
            return;
        } else {
            noDataMessage.classList.add('d-none');
        }
        
        // í…Œì´ë¸” í–‰ ìƒì„±
        topQueries.forEach((query, index) => {
            const row = document.createElement('tr');
            
            const formatDate = (dateString) => {
                const date = new Date(dateString);
                return date.toLocaleString('ko-KR');
            };
            
            row.innerHTML = `
                <td style="font-family: 'Inter', sans-serif; font-weight: 400;">${index + 1}</td>
                <td style="font-family: 'Inter', sans-serif; font-weight: 400;">${query.query_text}</td>
                <td style="font-family: 'Inter', sans-serif; font-weight: 400;">${query.category || 'ë¯¸ë¶„ë¥˜'}</td>
                <td style="font-family: 'Inter', sans-serif; font-weight: 400;">${query.count}</td>
                <td style="font-family: 'Inter', sans-serif; font-weight: 400;">${formatDate(query.first_asked)}</td>
                <td style="font-family: 'Inter', sans-serif; font-weight: 400;">${formatDate(query.last_asked)}</td>
            `;
            
            tableBody.appendChild(row);
        });
    }
});

// ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€ ê¸°ëŠ¥
document.querySelector('.mobile-menu-btn').addEventListener('click', function() {
    document.querySelector('.nav-links').classList.toggle('active');
    this.classList.toggle('active');
});

// í…Œë§ˆ í† ê¸€ ê¸°ëŠ¥ (ë©”ì¸ í˜ì´ì§€ì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ìˆ˜ì •)
document.getElementById('theme-toggle').addEventListener('click', function() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    
    // ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
    updateThemeIcon(newTheme);
});

// í…Œë§ˆ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updateThemeIcon(theme) {
    const sunIcon = document.querySelector('.sun-icon');
    const moonIcon = document.querySelector('.moon-icon');
    
    if (theme === 'dark') {
        sunIcon.style.display = 'block';
        moonIcon.style.display = 'none';
    } else {
        sunIcon.style.display = 'none';
        moonIcon.style.display = 'block';
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ í…Œë§ˆ ì ìš©
const savedTheme = localStorage.getItem('theme') || 'light';
document.documentElement.setAttribute('data-theme', savedTheme);
updateThemeIcon(savedTheme);

// ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ í´ë¦­ ì‹œ ëª¨ë°”ì¼ ë©”ë‰´ ë‹«ê¸°
document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', () => {
        document.querySelector('.nav-links').classList.remove('active');
        document.querySelector('.mobile-menu-btn').classList.remove('active');
    });
});
</script>

<!-- Bootstrap JS ì¶”ê°€ -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>